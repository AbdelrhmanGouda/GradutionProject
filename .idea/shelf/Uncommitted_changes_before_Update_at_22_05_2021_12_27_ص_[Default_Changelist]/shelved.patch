Index: app/src/main/java/com/example/graduationproject/Activities/MainActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.graduationproject.Activities;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.appcompat.app.ActionBarDrawerToggle;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.appcompat.widget.Toolbar;\r\nimport androidx.core.view.GravityCompat;\r\nimport androidx.drawerlayout.widget.DrawerLayout;\r\n\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.view.MenuItem;\r\nimport android.view.View;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.example.graduationproject.Fragments.AppointmentsFragment;\r\nimport com.example.graduationproject.Fragments.CartFragment;\r\nimport com.example.graduationproject.Fragments.FriendListFragment;\r\nimport com.example.graduationproject.Fragments.HomeFragment;\r\nimport com.example.graduationproject.Fragments.NotificationFragment;\r\nimport com.example.graduationproject.Fragments.ProfileFragment;\r\nimport com.example.graduationproject.Fragments.TherapistsFragment;\r\nimport com.example.graduationproject.R;\r\nimport com.example.graduationproject.Sign.SignMainActivity;\r\nimport com.facebook.login.LoginManager;\r\nimport com.google.android.material.navigation.NavigationView;\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.auth.FirebaseUser;\r\nimport com.google.firebase.database.DataSnapshot;\r\nimport com.google.firebase.database.DatabaseError;\r\nimport com.google.firebase.database.FirebaseDatabase;\r\nimport com.google.firebase.database.Query;\r\nimport com.google.firebase.database.ValueEventListener;\r\nimport com.squareup.picasso.Picasso;\r\n\r\nimport de.hdodenhof.circleimageview.CircleImageView;\r\n\r\npublic class MainActivity extends AppCompatActivity implements NavigationView.OnNavigationItemSelectedListener {\r\n    private Toolbar toolbar;\r\n    private DrawerLayout drawerLayout;\r\n    private NavigationView navigationView;\r\n    public FirebaseAuth mAuth;\r\n    String userName,userImage;\r\n    CircleImageView imgHead;\r\n    View view;\r\n    TextView textName;\r\n\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_main);\r\n\r\n        toolbar=findViewById(R.id.toolbar);\r\n        setSupportActionBar(toolbar);\r\n\r\n\r\n        drawerLayout =findViewById(R.id.drawer_layout);\r\n        ActionBarDrawerToggle toggle=new ActionBarDrawerToggle(this,drawerLayout,toolbar,R.string.open,R.string.close);\r\n        drawerLayout.addDrawerListener(toggle);\r\n        toggle.syncState();\r\n        mAuth = FirebaseAuth.getInstance();\r\n        getHeader();\r\n\r\n        navigationView=findViewById(R.id.navigation);\r\n        view =navigationView.getHeaderView(0);\r\n        imgHead=view.findViewById(R.id.header_image);\r\n        textName=view.findViewById(R.id.header_name);\r\n        navigationView.setNavigationItemSelectedListener(this);\r\n        if(savedInstanceState==null) {\r\n            getSupportFragmentManager().beginTransaction().replace(R.id.fragment_container,new HomeFragment()).commit();\r\n            navigationView.setCheckedItem(R.id.home);\r\n        }\r\n\r\n    }\r\n    @Override\r\n    public void onBackPressed() {\r\n        if(drawerLayout.isDrawerOpen(GravityCompat.START)){\r\n            drawerLayout.closeDrawer(GravityCompat.START);\r\n        }else{\r\n            super.onBackPressed();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public boolean onNavigationItemSelected(@NonNull MenuItem menuItem) {\r\n        switch (menuItem.getItemId()){\r\n            case R.id.home:\r\n                getSupportFragmentManager().beginTransaction().replace(R.id.fragment_container,new HomeFragment()).commit();\r\n                break;\r\n            case R.id.profile:\r\n                getSupportFragmentManager().beginTransaction().replace(R.id.fragment_container,new ProfileFragment()).commit();\r\n                break;\r\n            case R.id.friends_list:\r\n                getSupportFragmentManager().beginTransaction().replace(R.id.fragment_container,new FriendListFragment()).commit();\r\n                break;\r\n            case R.id.therapists:\r\n                getSupportFragmentManager().beginTransaction().replace(R.id.fragment_container,new TherapistsFragment()).commit();\r\n                break;\r\n            case R.id.notification:\r\n                getSupportFragmentManager().beginTransaction().replace(R.id.fragment_container,new NotificationFragment()).commit();\r\n                break;\r\n            case R.id.appointments:\r\n                getSupportFragmentManager().beginTransaction().replace(R.id.fragment_container,new AppointmentsFragment()).commit();\r\n                break;\r\n            case R.id.cart:\r\n                getSupportFragmentManager().beginTransaction().replace(R.id.fragment_container,new CartFragment()).commit();\r\n                break;\r\n            case R.id.log_out:\r\n\r\n                Toast.makeText(this, \"Log Out\", Toast.LENGTH_SHORT).show();\r\n\r\n                mAuth.signOut();\r\n                FirebaseAuth.getInstance().signOut();\r\n                LoginManager.getInstance().logOut();\r\n\r\n                Intent intent = new Intent(getApplicationContext(), SignMainActivity.class);\r\n                intent.setFlags(Intent.FLAG_ACTIVITY_NO_HISTORY);\r\n                intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);\r\n                intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\r\n                startActivity(intent);\r\n\r\n                //Toast.makeText(getActivity(),\"Logged out!\",Toast.LENGTH_LONG).show();\r\n\r\n                break;\r\n\r\n        }\r\n        drawerLayout.closeDrawer(GravityCompat.START);\r\n        return true;\r\n    }\r\n    private void getHeader() {\r\n        FirebaseUser firebaseUser=mAuth.getCurrentUser();\r\n        final String id=firebaseUser.getUid();\r\n\r\n        Query query6 = FirebaseDatabase.getInstance().getReference().child(\"Users\").child(id);\r\n        query6.addListenerForSingleValueEvent(new ValueEventListener() {\r\n            @Override\r\n            public void onDataChange(@NonNull DataSnapshot dataSnapshot) {\r\n                if(dataSnapshot!=null){\r\n                    if (dataSnapshot.exists() && dataSnapshot.getChildrenCount()>0&&dataSnapshot.getValue().toString().length()>0) {\r\n                        for (DataSnapshot snapshot : dataSnapshot.getChildren()) {\r\n                            userName=dataSnapshot.child(\"name\").getValue(String.class);\r\n                            userImage=dataSnapshot.child(\"uri\").getValue(String.class);\r\n                            textName.setText(userName);\r\n                            Picasso.get().load(userImage).into(imgHead);\r\n\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            @Override\r\n            public void onCancelled(@NonNull DatabaseError databaseError) {\r\n\r\n            }\r\n        });\r\n\r\n\r\n    }\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/graduationproject/Activities/MainActivity.java	(revision 50532eb4066a30e981fa5f07b2e0e537b8f3d5c5)
+++ app/src/main/java/com/example/graduationproject/Activities/MainActivity.java	(date 1621617113339)
@@ -9,6 +9,7 @@
 
 import android.content.Intent;
 import android.os.Bundle;
+import android.util.Log;
 import android.view.MenuItem;
 import android.view.View;
 import android.widget.TextView;
@@ -105,7 +106,9 @@
                 getSupportFragmentManager().beginTransaction().replace(R.id.fragment_container,new AppointmentsFragment()).commit();
                 break;
             case R.id.cart:
-                getSupportFragmentManager().beginTransaction().replace(R.id.fragment_container,new CartFragment()).commit();
+                Intent i = new Intent(this,SendNotif.class);
+                startActivity(i);
+               // getSupportFragmentManager().beginTransaction().replace(R.id.fragment_container,new CartFragment()).commit();
                 break;
             case R.id.log_out:
 
@@ -142,6 +145,7 @@
                         for (DataSnapshot snapshot : dataSnapshot.getChildren()) {
                             userName=dataSnapshot.child("name").getValue(String.class);
                             userImage=dataSnapshot.child("uri").getValue(String.class);
+                            Log.i(userName.toString(), "onDataChange: ");
                             textName.setText(userName);
                             Picasso.get().load(userImage).into(imgHead);
 
Index: app/src/main/java/com/example/graduationproject/Notification/Data.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/graduationproject/Notification/Data.java	(date 1621567178030)
+++ app/src/main/java/com/example/graduationproject/Notification/Data.java	(date 1621567178030)
@@ -0,0 +1,29 @@
+package com.example.graduationproject.Notification;
+
+public class Data {
+    private String Title, message;
+
+    public Data(String title, String message) {
+        this.Title = title;
+        this.message = message;
+    }
+
+    public Data() {
+    }
+
+    public String getTitle() {  
+        return Title;
+    }
+
+    public void setTitle(String title) {
+        this.Title = title;
+    }
+
+    public String getMessages() {
+        return message;
+    }
+
+    public void setMessages(String messages) {
+        this.message = messages;
+    }
+}
Index: app/src/main/java/com/example/graduationproject/Notification/MyResponse.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/graduationproject/Notification/MyResponse.java	(date 1621566229712)
+++ app/src/main/java/com/example/graduationproject/Notification/MyResponse.java	(date 1621566229712)
@@ -0,0 +1,5 @@
+package com.example.graduationproject.Notification;
+
+public class MyResponse {
+    public int success;
+}
Index: app/src/main/java/com/example/graduationproject/Notification/Client.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/graduationproject/Notification/Client.java	(date 1621452245890)
+++ app/src/main/java/com/example/graduationproject/Notification/Client.java	(date 1621452245890)
@@ -0,0 +1,14 @@
+package com.example.graduationproject.Notification;
+
+import retrofit2.Retrofit;
+import retrofit2.converter.gson.GsonConverterFactory;
+
+public class Client {
+    private static Retrofit retrofit=null;
+    public static Retrofit getClient(String url){
+        if (retrofit==null){
+            retrofit = new  Retrofit.Builder().baseUrl(url).addConverterFactory(GsonConverterFactory.create()).build();
+        }
+        return retrofit;
+    }
+}
Index: app/src/main/java/com/example/graduationproject/Activities/SendNotif.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/graduationproject/Activities/SendNotif.java	(date 1621567982371)
+++ app/src/main/java/com/example/graduationproject/Activities/SendNotif.java	(date 1621567982371)
@@ -0,0 +1,96 @@
+package com.example.graduationproject.Activities;
+
+import androidx.annotation.NonNull;
+import androidx.appcompat.app.AppCompatActivity;
+
+import android.os.Bundle;
+import android.util.Log;
+import android.view.View;
+import android.widget.Button;
+import android.widget.EditText;
+import android.widget.Toast;
+
+import com.example.graduationproject.Notification.APIService;
+import com.example.graduationproject.Notification.Client;
+import com.example.graduationproject.Notification.Data;
+import com.example.graduationproject.Notification.MyResponse;
+import com.example.graduationproject.Notification.NotificationSender;
+import com.example.graduationproject.Notification.Token;
+import com.example.graduationproject.R;
+import com.google.firebase.auth.FirebaseAuth;
+import com.google.firebase.auth.FirebaseUser;
+import com.google.firebase.database.DataSnapshot;
+import com.google.firebase.database.DatabaseError;
+import com.google.firebase.database.FirebaseDatabase;
+import com.google.firebase.database.ValueEventListener;
+import com.google.firebase.iid.FirebaseInstanceId;
+
+import retrofit2.Call;
+import retrofit2.Callback;
+import retrofit2.Response;
+
+public class SendNotif extends AppCompatActivity {
+    EditText UserTB,Title,Message;
+    Button send;
+    private APIService apiService;
+
+    @Override
+    protected void onCreate(Bundle savedInstanceState) {
+        super.onCreate(savedInstanceState);
+        setContentView(R.layout.activity_send_notif);
+        UserTB=findViewById(R.id.UserID);
+        Title=findViewById(R.id.Title);
+        Message=findViewById(R.id.Messages);
+        send=findViewById(R.id.button2);
+        apiService= Client.getClient("https://fcm.googleapis.com/").create(APIService.class);
+        send.setOnClickListener(new View.OnClickListener() {
+            @Override
+            public void onClick(View view) {
+                FirebaseDatabase.getInstance().getReference().child("Tokens").child(UserTB.getText().toString().trim()).child("token")
+                        .addListenerForSingleValueEvent(new ValueEventListener() {
+                            @Override
+                            public void onDataChange(@NonNull DataSnapshot snapshot) {
+                                String userToken=snapshot.getValue(String.class);
+                                sendNotifications(userToken,Title.getText().toString().trim(),Message.getText().toString().trim());
+                                Log.i("TAG", "onDataChange: ");
+                            }
+
+                            @Override
+                            public void onCancelled(@NonNull DatabaseError error) {
+
+                            }
+                        });
+
+            }
+        });
+        UpdateToken();
+    }
+    private void UpdateToken() {
+        FirebaseUser user = FirebaseAuth.getInstance().getCurrentUser();
+        String refreshToken= FirebaseInstanceId.getInstance().getToken();
+        Token token =new Token(refreshToken);
+        FirebaseDatabase.getInstance().getReference("Tokens").child(FirebaseAuth.getInstance().getCurrentUser().getUid()).setValue(token);
+    }
+    private void sendNotifications(String userToken, String title, String message) {
+        Data data =new Data(title,message);
+        NotificationSender notificationSender = new NotificationSender(data,userToken);
+        Log.i("TAG", "sendNotifications: ");
+        apiService.sendNotification(notificationSender).enqueue(new Callback<MyResponse>()
+        {
+            @Override
+            public void onResponse(Call<MyResponse> call, Response<MyResponse> response) {
+                if (response.code()==200){
+                    if (response.body().success!=1){
+                        Toast.makeText(getApplicationContext(), "Failed", Toast.LENGTH_LONG).show();
+                    }
+                }
+            }
+
+            @Override
+            public void onFailure(Call<MyResponse> call, Throwable t) {
+
+            }
+        });
+    }
+
+}
\ No newline at end of file
Index: app/src/main/java/com/example/graduationproject/Notification/NotificationSender.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/graduationproject/Notification/NotificationSender.java	(date 1621451377194)
+++ app/src/main/java/com/example/graduationproject/Notification/NotificationSender.java	(date 1621451377194)
@@ -0,0 +1,14 @@
+package com.example.graduationproject.Notification;
+
+public class NotificationSender {
+    public Data data;
+    public String to;
+
+    public NotificationSender(Data data, String to) {
+        this.data = data;
+        this.to = to;
+    }
+
+    public NotificationSender() {
+    }
+}
Index: app/src/main/java/com/example/graduationproject/Notification/MyFirebaseIdService.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/graduationproject/Notification/MyFirebaseIdService.java	(date 1621453674325)
+++ app/src/main/java/com/example/graduationproject/Notification/MyFirebaseIdService.java	(date 1621453674325)
@@ -0,0 +1,27 @@
+package com.example.graduationproject.Notification;
+
+import androidx.annotation.NonNull;
+
+import com.google.firebase.auth.FirebaseAuth;
+import com.google.firebase.auth.FirebaseUser;
+import com.google.firebase.database.FirebaseDatabase;
+import com.google.firebase.iid.FirebaseInstanceId;
+import com.google.firebase.messaging.FirebaseMessagingService;
+
+public class MyFirebaseIdService extends FirebaseMessagingService {
+    @Override
+    public void onNewToken(@NonNull String s) {
+        super.onNewToken(s);
+        FirebaseUser firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
+        String refreshToken= FirebaseInstanceId.getInstance().getToken();
+        if (firebaseUser != null){
+            updateToken(refreshToken);
+        }
+
+    }
+    private void updateToken(String refreshToken) {
+        FirebaseUser firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
+        Token token1 =new Token(refreshToken);
+        FirebaseDatabase.getInstance().getReference("Tokens").child(FirebaseAuth.getInstance().getCurrentUser().getUid()).setValue(token1);
+    }
+}
Index: app/src/main/java/com/example/graduationproject/Notification/APIService.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/graduationproject/Notification/APIService.java	(date 1621566228076)
+++ app/src/main/java/com/example/graduationproject/Notification/APIService.java	(date 1621566228076)
@@ -0,0 +1,17 @@
+package com.example.graduationproject.Notification;
+
+import retrofit2.Call;
+import retrofit2.http.Body;
+import retrofit2.http.Headers;
+import retrofit2.http.POST;
+
+public interface APIService {
+    @Headers(
+        {
+            "Content-Type:application/json",
+            "Authorization:key=AAAAvkept9I:APA91bGLUASRrfj3pxc97dGKBc31OZldaejWcu0M1Vqk-shRZRGzhbpnO5oRCdBHteEbd05sKa3jOBAplMAUaympIQcIg-XG6PIHhGxFor48I_UvkqEwcth_jo8eFCVhOJT6mbrv6GQM"
+        }
+    )
+    @POST("fcm/send")
+    Call<MyResponse> sendNotification(@Body NotificationSender body);
+}
Index: app/src/main/java/com/example/graduationproject/Notification/MyFirebaseMessagingService.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/graduationproject/Notification/MyFirebaseMessagingService.java	(date 1621568962662)
+++ app/src/main/java/com/example/graduationproject/Notification/MyFirebaseMessagingService.java	(date 1621568962662)
@@ -0,0 +1,42 @@
+package com.example.graduationproject.Notification;
+
+import android.app.NotificationChannel;
+import android.app.NotificationManager;
+import android.content.Context;
+import android.os.Build;
+import android.util.Log;
+
+import androidx.annotation.NonNull;
+import androidx.core.app.NotificationCompat;
+
+import com.example.graduationproject.R;
+import com.google.firebase.messaging.FirebaseMessagingService;
+import com.google.firebase.messaging.RemoteMessage;
+
+public class MyFirebaseMessagingService extends FirebaseMessagingService {
+    String title,message;
+  String CHANNAL_ID="good";
+    @Override
+    public void onMessageReceived(@NonNull RemoteMessage remoteMessage) {
+        super.onMessageReceived(remoteMessage);
+        title=remoteMessage.getData().get("Title");
+        message=remoteMessage.getData().get("Message");
+
+        NotificationCompat.Builder builder = new NotificationCompat.Builder(getApplicationContext())
+                .setSmallIcon(R.drawable.ic_baseline_notifications_24)
+                .setContentTitle(title)
+                .setContentText(message);
+       /* NotificationManager manager = (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);
+        manager.notify(0,builder.build());
+*/
+
+     if(Build.VERSION.SDK_INT>=Build.VERSION_CODES.O){
+        NotificationChannel notificationChannel = new NotificationChannel(CHANNAL_ID,"notification",NotificationManager.IMPORTANCE_DEFAULT);
+        NotificationManager manager = (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);
+        manager.createNotificationChannel(notificationChannel);
+        manager.notify(0,builder.build());
+            Log.i("Gouda", "onMessageReceived: ");
+    }
+   }
+
+}
Index: app/src/main/java/com/example/graduationproject/Notification/Token.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/graduationproject/Notification/Token.java	(date 1621442063208)
+++ app/src/main/java/com/example/graduationproject/Notification/Token.java	(date 1621442063208)
@@ -0,0 +1,20 @@
+package com.example.graduationproject.Notification;
+
+public class Token {
+    String token;
+
+    public Token(String token) {
+        this.token = token;
+    }
+
+    public Token() {
+    }
+
+    public String getToken() {
+        return token;
+    }
+
+    public void setToken(String token) {
+        this.token = token;
+    }
+}
